@page "/availableshifts"
@using Festivalproject.Shared.Models
@using Festivalproject.Client.Components
@using Blazored.Modal
@using Blazored.Modal.Services


@inject IJSRuntime JSRuntime
@inject HttpClient Http
@inject IModalService ModalService


<h3>AvailableShifts</h3>

<div id="calendar"></div>


@code {
    
    private List<Shift> AvailableShift { get; set; } = new List<Shift>();

    protected override async Task OnInitializedAsync()
    {
        AvailableShift = await Http.GetFromJsonAsync<List<Shift>>("https://localhost:7251/api/Shifts/false");
        
    // Create a DotNetObjectReference to pass to JavaScript
        var dotNetReference = DotNetObjectReference.Create(this);

    // Convert the list of shifts to an array of events thats later passed over to the js function
        var events = AvailableShift.Select(s => new
        {
    //Setting the properties of the event object -> ex. title = name of the shift...
            title = s.Name,
            start = s.startTime.ToString("s"),
            end = s.endTime.ToString("s"),
            description = s.Description,
            capacity = Convert.ToString(s.Capacity),
            duration = Convert.ToString(s.Duration),
    //to array conversion
        }).ToArray();

    //importing the js file from "wwwroot/js" and calling the initializeCalendar function with the events array as parameters
        var module = await JSRuntime.InvokeAsync<IJSObjectReference>("import", "./js/fullcalender.js");
        await module.InvokeVoidAsync("initializeCalendar", new object[] { events, dotNetReference });
    }
    
    [JSInvokable]
    public async Task ShiftsDialog(string shiftName, string shiftDescription, string shiftCapacity, string shiftDuration, string shiftStart, string shiftEnd)
    {
        var options = new ModalOptions { Size = ModalSize.Medium };
        var parameters = new ModalParameters();
        parameters.Add("ModalTitle", shiftName);
        parameters.Add("ModalDescription", shiftDescription);
        parameters.Add("ModalCapacity", shiftCapacity);
        parameters.Add("ModalDuration", shiftDuration);
        parameters.Add("ModalStart", shiftStart);
        parameters.Add("ModalEnd", shiftEnd);

        var dialog = ModalService.Show<ShiftsDialog>("Shift Dialog", parameters, options);
        var result = await dialog.Result;
    }
}